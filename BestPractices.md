# Introduction

With the 2017 revision of SP 800-63-3, NIST pursued a document development method based on the open source software development model. This time-tested development model 

# Code Repositories

All document sources need to be tracked by a source control repository. Additionally, any configuration or template files needed to produce the final document should be included as well. If these build artifacts specific to the document set you're working on, it should go in the repository with the document source. If 

## Valuing Diffs

The markdown format was chosen partially to allow for human-readable diffs between different versions of a file. 

## What Goes In

There will be documents that are edited directly by people as well as things that are generated by automated tools. Wherever possible, store only the human-edited components and leave the machine-generated components for an automated system.

In some cases, such as graphics, the production tools used can't be integrated into the publication process. In these cases, checking in both the source file (such as .graffle or .psd) as well as the generated artifact (such as .png) is recommended.

## Make Things Public

Transparency is one of the best aspects of the open source model. Keep everything in the open wherever possible.

## Publish Early and Often

Some people might not like what you're creating, or they might not understand that it's not finished yet. It's admittedly scary to allow the kind of public scrutiny.

## Allow Interaction

It may be tempting to lock down the repository such that only team members can submit issues and pull requests. This style of control is counter to the ethos and value of the open source model, and you should instead endeavor to allow interaction from all interested parties in a variety of ways. 

## Pull Requests

All edits should be submitted as pull requests, even from the core editing team. This encourages discrete branches for different edits.

Pull requests should be allowed from external parties and subject to review and potential approval or rejection from the core editorial team.

## Who Gets Write Access

Allowing universal read access to the repository, and allowing universal submission of issues and pull requests, does not mean that you're allowing universal write access to the document itself. It's best if a small group of core editors has write access to the main branch. 

Pull requests from everybody, including team members, should be subject to review from the appropriate parties before merging. 

## Talking Offline

Even in the pursuit of transparency, some internal team discussions really do need to happen outside the public forum. For this, private repositories and trackers are helpful, as are email lists just for the team.

However, wherever possible and as soon as possible, discussion and resolution should be moved to the public tracker and repository.

# Issue Trackers

The Issue Tracker feature of GitHub provides a means for anyone, including external parties and team members, to report problems, suggest changes, and 

## Comments

Not all issues being reported should be taken as bugs that need to be fixed. Some are comments to be considered in the context of the document, a place for stakeholders to post their position on the document whether or not that position will change the document itself.

## Issue Templates

GitHub allows you to set up a template for new issues. This template can be used to prompt people filling out the issue to include the kind of information you're after.

Keep in mind that anybody submitting an issue can just delete the template. You might find that the internal team will often do this for expediency, but external contributors will tend to use the template.

## Labels and Milestones

All issues should be labeled with their associated document or section, nature, and proposed resolution.

Milestones can be used to collect important issues together and mark document release stages.

## Referencing Commits

Git commits can reference issues by including the issue number in the commit message. In GitHub, this automatically creates a link within the issue page. 

## Saying "No"

While every issue being reported needs to be read and considered, not every issue is going to be *accepted*. 

## Email Inputs

Not everyone who wants to contribute to a document, especially a government document, is going to be fluent in open source software development tools. Therefore, it's important to have additional submission channels such as email for these users.

All inputs received in such alternative channels should be broken into discrete issues and submitted by the team itself to the issue tracker. This behavior needs to be clearly displayed to anyone using the alternative channels so that nobody is surprised when their email's content is placed on a public website, with attribution.

## Exposing Mistakes

It's tempting to hold back on development and realease of the document to the public repository until it's in a "good enough" state, but it's strongly encouraged that people release early explicitly because 

It's better to have a mistake exposed early, so that it can be found and fixed by a member of the public, rather than risking having that mistake make it through to the final document.

# Branches

A *branch* in git is a set of changes with a related history. Every time a new set of edits are being made, they should be put onto their own branch. 

While it may seem like overkill to create a new branch for each cohesive action, branches in git are cheap, unlike many other source control systems. 

## Forks

Git repositories can be cloned and forked to multiple users in multiple locations. Encourage all team members to keep their own fork of the repository for pushing experimental edits and propositions for discussion.

Team members can use the main fork for development work, but all work should be done on branches as noted above.

External entities will use a fork of the repository to make their edits and propose pull requests from. 

## Multiple Remotes

When working with a fork, it's important to keep up to date. A good method for this is to have multiple remote repositories: the "upstream" repository that you read from, and the "origin" repository that you write to. 

Managing a new branch on your fork for making a change would then follow the process:

1. Update your references: git fetch upstream
1. Create your branch off of the latest upstream branch: git checkout -b mybranchname upstream/master 
1. Edit and commit changes to your branch
1. Push your branch to your fork: git push origin mybranchname
1. Create a pull request on GitHub from your branch

## Merging Branches

If you're working on a clean copy of the upstream project for your branch, it should merge seamlessly when the pull request is accepted. 

However, if multiple parties are working in parallel then there can be conflicts. It is up to the editing team who is accepting the pull requests to manage these conflicts during the merge process.

## Multiple Parallel Branches

When working on two issues that are meant to be considered as separate pull requests, use two different branches both based from the same branch point.

## Rebasing

In git, each commit has a *parent* commit that indicates the state of the document at the point the branch was originally created. Occasionally, there will be a need to change the parent of a branch's root commit. Common reasons include:

1. A new branch was created on top of an existing working branch instead of the upstream. 
1. A branch is based on an old upstream commit and needs to be placed onto a newer upstream commit.

# Markdown

The markdown language is a simplified textual representation of common document structural elements. 

## Images

Images can be added to a document by including the image file in the repository and adding an image link to the image file.

All images should have figure reference numbers.

## Sections

Documents are divided up into logical sections.

## Links

Links within a document should contain the section number in the link text to allow for cross-referencing in the printed out version of the document.

## Tables

In the past, tables were used extensively in NIST publications as a means of formatting and displaying large amounts of information. In today's system, it is preferred to other structures such as lists, paragraphs, and sections to convey this information instead. This lends to better readability and information organization.

However, tables are still supported in the markdown language to be used where appropriate.

All tables should have figure reference numbers.

## Lists

Lists should be numbered wherever possible to allow for easier reference to individual items within the lists.

Lists in markdown automatically create numbers, and the source text should use only "1." for each element instead of "1.", "2.", and so forth. Both of these approaches will render identically, but using only "1." for list items will make it easier to rearrange the elements in a list without having to renumber them by hand.

## Line Endings and Special Characters

Even though we're well into the 21st century, source control systems are still sometimes plagued by errors with document line endigns and the use of special characters. 

# Document Production

The NIST Pages system renders both HTML and PDF from the same markdown source.

## Semantic Document Structure

Because there are multiple output formats, it is important to keep the input as close to pure markdown as possible. While it may be tempting to insert a raw HTML table in the midst of your markdown to have extra fine control over placement of things, doing so will inevitably break other display and consumption formats like PDF. Instead, stick to markdown and structure documents semantically, leaving the presentation layer to the document processing system and its associated templates.

## Special Formatting

NIST's extensions to the base markdown language provide for a number of useful additions that are often featured in NIST documents. 

If there are gaps in the current markdown capability, where a very specific formatting is required, then the best long-term solution is to develop an extension to address the format requirements across all different publication formats.

## Continuous Integration

One of the best features of the document production system is a form of continuous integration. Whenever a change is made and checked in to the repository, the document processing chain detects this and automatically generates the downstream documents in all the various formats as required. 